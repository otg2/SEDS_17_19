{"paragraphs":[{"text":"%md\n\n### Ballot Leader Election\n\nIn this programming assignment you will have to complete the implementation of a special Leader Election Algorithm with monotonically increasing ballots.\n\nWhen you are done you simply have to export your notebook and then upload it in the \"Programming Exercise 1\" page.\n\n**Things to Remember**:\n1. Basic components such as `PerfectLink` are already provided. No need to implement them.\n2. Execute the imports defined below **before** compiling your component implementations.\n3. We recommend making use of the component state and internal messages we have provided, if any, to complete the implementation logic.\n4. You can always print messages to the output log, from within handlers to see what happens during the simulation. e.g. `println(s\"Process $self delivers message $msg\");`\n5. Remember that during the simulation check you can print and observe the simulation time, i.e. with `System.currentTimeMillis()`.\n5. Do not forget to run the checker code block after each component implementation to ensure that all properties are satisfied **before** exporting and submitting the notebook.\n6. You can always restart the Kompics Interpreter to start fresh (Interpreter→KompicsInterpreter→Click Restart)\n\nGood luck! :)","user":"anonymous","dateUpdated":"2017-11-24T00:29:57+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","colWidth":12,"editorHide":true,"fontSize":9,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1511483180938_942568132","id":"20160927-134633_1462429338","dateCreated":"2017-11-24T00:26:20+0000","dateStarted":"2017-11-24T00:29:57+0000","dateFinished":"2017-11-24T00:29:57+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1055","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h3>Ballot Leader Election</h3>\n<p>In this programming assignment you will have to complete the implementation of a special Leader Election Algorithm with monotonically increasing ballots.</p>\n<p>When you are done you simply have to export your notebook and then upload it in the &ldquo;Programming Exercise 1&rdquo; page.</p>\n<p><strong>Things to Remember</strong>:<br/>1. Basic components such as <code>PerfectLink</code> are already provided. No need to implement them.<br/>2. Execute the imports defined below <strong>before</strong> compiling your component implementations.<br/>3. We recommend making use of the component state and internal messages we have provided, if any, to complete the implementation logic.<br/>4. You can always print messages to the output log, from within handlers to see what happens during the simulation. e.g. <code>println(s&quot;Process $self delivers message $msg&quot;);</code><br/>5. Remember that during the simulation check you can print and observe the simulation time, i.e. with <code>System.currentTimeMillis()</code>.<br/>5. Do not forget to run the checker code block after each component implementation to ensure that all properties are satisfied <strong>before</strong> exporting and submitting the notebook.<br/>6. You can always restart the Kompics Interpreter to start fresh (Interpreter→KompicsInterpreter→Click Restart)</p>\n<p>Good luck! :)</p>\n</div>"}]}},{"text":"\nimport se.kth.edx.id2203.core.ExercisePrimitives.AddressUtils._\nimport se.kth.edx.id2203.core.ExercisePrimitives.AddressUtils\nimport se.kth.edx.id2203.core.Ports._\nimport se.kth.edx.id2203.validation._\nimport se.kth.edx.id2203.validation.checkBallotLE\nimport se.sics.kompics.network._\nimport se.sics.kompics.sl._\nimport se.sics.kompics.timer.{ScheduleTimeout, Timeout, Timer}\nimport se.sics.kompics.{KompicsEvent, Start}\n\nimport scala.collection.mutable;\n","user":"anonymous","dateUpdated":"2017-11-24T00:28:02+0000","config":{"lineNumbers":false,"tableHide":false,"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala","colWidth":12,"fontSize":9,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1511483180943_940644388","id":"20160830-154917_187608468","dateCreated":"2017-11-24T00:26:20+0000","dateStarted":"2017-11-24T00:28:04+0000","dateFinished":"2017-11-24T00:28:05+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:1056"},{"text":"%md\n\n## Gossip-Based Ballot Leader Election ##\n\nA Ballot Leader Election Abstraction, in Kompics terms, is a simple component that **provides** the following port *(already imported in the notebook)*.\n\n    class BallotLeaderElection extends Port {\n        indication[BLE_Leader];\n    }\n  \n\nA **BallotLeaderElection** component should indicate to subscribers of its port that a new leader is elected (along with a ballot) with a `BLE_Leader` message that contains the address of the leader the ballot number (already provided):\n\n    case class BLE_Leader(leader: Address, ballot: Long) extends KompicsEvent;\n\nThe following properties define the expected behavior of a consensus abstraction more specifically:\n\n1. **Completeness**: *Eventually every correct process elects some correct process as long as a majority is correct*\n2. **Eventual Agreement**: *Eventually no two correct processes elect different correct processes.*\n3. **Monotonic Unique Ballots**: *Ballot numbers of consecutively elected processes should be unique and monotonically increasing.*\n    \nThe recommended algorithm to use is the the one we call \"Gossip Leader Election\" which elects the top process using a majority of gossiping messages.\nYou can find the algorithm in the following  <a href=\"https://courses.edx.org/asset-v1:KTHx+ID2203.2x+2016T4+type@asset+block@ble.pdf\" target=\"_blank\">document</a>.\n","user":"anonymous","dateUpdated":"2017-11-24T00:29:59+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","colWidth":12,"editorHide":true,"fontSize":9,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1511483180944_951032608","id":"20160930-115754_781424547","dateCreated":"2017-11-24T00:26:20+0000","dateStarted":"2017-11-24T00:29:59+0000","dateFinished":"2017-11-24T00:29:59+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1057","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>Gossip-Based Ballot Leader Election</h2>\n<p>A Ballot Leader Election Abstraction, in Kompics terms, is a simple component that <strong>provides</strong> the following port <em>(already imported in the notebook)</em>.</p>\n<pre><code>class BallotLeaderElection extends Port {\n    indication[BLE_Leader];\n}\n</code></pre>\n<p>A <strong>BallotLeaderElection</strong> component should indicate to subscribers of its port that a new leader is elected (along with a ballot) with a <code>BLE_Leader</code> message that contains the address of the leader the ballot number (already provided):</p>\n<pre><code>case class BLE_Leader(leader: Address, ballot: Long) extends KompicsEvent;\n</code></pre>\n<p>The following properties define the expected behavior of a consensus abstraction more specifically:</p>\n<ol>\n  <li><strong>Completeness</strong>: <em>Eventually every correct process elects some correct process as long as a majority is correct</em></li>\n  <li><strong>Eventual Agreement</strong>: <em>Eventually no two correct processes elect different correct processes.</em></li>\n  <li><strong>Monotonic Unique Ballots</strong>: <em>Ballot numbers of consecutively elected processes should be unique and monotonically increasing.</em></li>\n</ol>\n<p>The recommended algorithm to use is the the one we call &ldquo;Gossip Leader Election&rdquo; which elects the top process using a majority of gossiping messages.<br/>You can find the algorithm in the following <a href=\"https://courses.edx.org/asset-v1:KTHx+ID2203.2x+2016T4+type@asset+block@ble.pdf\" target=\"_blank\">document</a>.</p>\n</div>"}]}},{"text":"\n//Provided Primitives to use in your implementation\n\n  case class CheckTimeout(timeout: ScheduleTimeout) extends Timeout(timeout);\n\n  case class HeartbeatReq(round: Long, highestBallot: Long) extends KompicsEvent;\n\n  case class HeartbeatResp(round: Long, ballot: Long) extends KompicsEvent;\n\n  private val ballotOne = 0x0100000000l;\n  \n  def ballotFromNAddress(n: Int, adr: Address): Long = {\n    val nBytes = com.google.common.primitives.Ints.toByteArray(n);\n    val addrBytes = com.google.common.primitives.Ints.toByteArray(adr.hashCode());\n    val bytes = nBytes ++ addrBytes;\n    val r = com.google.common.primitives.Longs.fromByteArray(bytes);\n    assert(r > 0); // should not produce negative numbers!\n    r\n  }\n\n  def incrementBallotBy(ballot: Long, inc: Int): Long = {\n    ballot + inc.toLong * ballotOne\n  }\n\n  private def incrementBallot(ballot: Long): Long = {\n    ballot + ballotOne\n  }","user":"anonymous","dateUpdated":"2017-11-24T00:28:02+0000","config":{"tableHide":false,"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala","colWidth":12,"fontSize":9,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1511483180944_951032608","id":"20160830-154940_1300846994","dateCreated":"2017-11-24T00:26:20+0000","dateStarted":"2017-11-24T00:28:05+0000","dateFinished":"2017-11-24T00:28:08+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:1058"},{"text":"\nclass GossipLeaderElection(init: Init[GossipLeaderElection]) extends ComponentDefinition {\n\n  val ble = provides[BallotLeaderElection];\n  val pl = requires[PerfectLink];\n  val timer = requires[Timer];\n\n  val self = init match {\n    case Init(s: Address) => s\n  }\n  val topology = cfg.getValue[List[Address]](\"ble.simulation.topology\");\n  val delta = cfg.getValue[Long](\"ble.simulation.delay\");\n  val majority = (topology.size / 2) + 1;\n\n  private var period = cfg.getValue[Long](\"ble.simulation.delay\");\n  private val ballots = mutable.Map.empty[Address, Long];\n\n  private var round = 0l;\n  private var ballot = ballotFromNAddress(0, self);\n\n  private var leader: Option[(Long, Address)] = None;\n  private var highestBallot: Long = ballot;\n\n  private def startTimer(delay: Long): Unit = {\n    val scheduledTimeout = new ScheduleTimeout(period);\n    scheduledTimeout.setTimeoutEvent(CheckTimeout(scheduledTimeout));\n    trigger(scheduledTimeout -> timer);\n  }\n\n  private def makeLeader(topProcess: (Long, Address)) {\n    /* INSERT YOUR CODE HERE */\n  }\n\n  private def checkLeader() {\n       /* INSERT YOUR CODE HERE */\n  }\n\n  ctrl uponEvent {\n    case _: Start => handle {\n      startTimer(period);\n    }\n  }\n\n  timer uponEvent {\n    case CheckTimeout(_) => handle {\n    /* INSERT YOUR CODE HERE */\n  }\n  }\n\n  pl uponEvent {\n    case PL_Deliver(src, HeartbeatReq(r, hb)) => handle {\n         /* INSERT YOUR CODE HERE */\n    }\n    case PL_Deliver(src, HeartbeatResp(r, b)) => handle {\n      /* INSERT YOUR CODE HERE */\n    }\n  }\n}","user":"anonymous","dateUpdated":"2017-11-24T00:29:12+0000","config":{"lineNumbers":true,"tableHide":false,"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala","colWidth":12,"fontSize":9,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1511483180944_951032608","id":"20160830-154952_592749615","dateCreated":"2017-11-24T00:26:20+0000","dateStarted":"2017-11-24T00:29:12+0000","dateFinished":"2017-11-24T00:29:14+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:1059"},{"text":"checkBallotLE[GossipLeaderElection];","user":"anonymous","dateUpdated":"2017-11-24T00:29:16+0000","config":{"tableHide":false,"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala","colWidth":12,"fontSize":9,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1511483180945_950647859","id":"20160830-155009_392534435","dateCreated":"2017-11-24T00:26:20+0000","dateStarted":"2017-11-24T00:29:16+0000","dateFinished":"2017-11-24T00:29:21+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:1060"},{"user":"anonymous","dateUpdated":"2017-11-24T00:28:03+0000","config":{"tableHide":false,"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala","colWidth":12,"fontSize":9,"results":[],"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1511483180945_950647859","id":"20160830-155043_337959288","dateCreated":"2017-11-24T00:26:20+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:1061"}],"name":"Exercise-Ballot Leader Election-Solution","id":"2CXW7XCKP","angularObjects":{"2BKQCVH92:shared_process":[],"2CVXXPNWV:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}